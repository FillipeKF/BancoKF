function abrirModalRestore(cis, zip) {

    const listaCIs = document.getElementById("listaCIs");
    listaCIs.innerHTML = "";

    cis.forEach(ci => {

        const bloco = document.createElement("div");
        bloco.style.background = "#252a33";
        bloco.style.borderRadius = "10px";
        bloco.style.padding = "12px";
        bloco.style.marginBottom = "15px";
        bloco.style.cursor = "pointer"; // indica que é clicável

        const h = document.createElement("h3");
        h.style.color = "var(--success)";
        h.textContent = `CI ${ci.ci} — ${new Date(ci.inicio).toLocaleDateString()}`;
        bloco.appendChild(h);

        const detalhes = document.createElement("div");
        detalhes.style.background = "#16191f";
        detalhes.style.borderRadius = "10px";
        detalhes.style.padding = "10px";
        detalhes.style.fontSize = "13px";
        detalhes.style.marginTop = "5px";

        detalhes.innerHTML = `
<b>Serviço:</b> ${ci.servico}<br>
<b>Equipe:</b> ${ci.equipe}<br>
<b>Início:</b> ${new Date(ci.inicio).toLocaleString()}<br>
<b>Fim:</b> ${ci.fim ? new Date(ci.fim).toLocaleString() : "-"}<br>
<b>Relato:</b> ${ci.relato || "-"}
`;

        bloco.appendChild(detalhes);

        // ao clicar no bloco, abre o modal de fotos
        bloco.onclick = () => {
            abrirModalFotos(ci, zip);
        };

        listaCIs.appendChild(bloco);
    });

    // abre o modal de restore
    document.getElementById("modalRestore").style.display = "flex";
}

function abrirModalFotos(ci, zip) {

    const listaFotos = document.getElementById("listaFotos");
    listaFotos.innerHTML = ""; // limpa fotos anteriores

    const fotosDiv = document.createElement("div");
    fotosDiv.style.display = "flex";
    fotosDiv.style.flexWrap = "wrap";
    fotosDiv.style.gap = "10px";
    fotosDiv.style.justifyContent = "center";

    Object.keys(zip.files).forEach(async filePath => {
        if (filePath.startsWith(ci.__pasta + "/fotos/")) {

            const file = zip.file(filePath);
            if (!file) return;

            const blob = await file.async("blob");

            const img = document.createElement("img");
            img.src = URL.createObjectURL(blob);

            // tamanho das fotos responsivo
            img.style.width = "80px";       
            img.style.height = "80px";      
            img.style.objectFit = "cover";  
            img.style.borderRadius = "8px";

            fotosDiv.appendChild(img);
        }
    });

    listaFotos.appendChild(fotosDiv);

    document.getElementById("modalFotos").style.display = "flex";
}

// função para fechar qualquer modal
function fecharModal(id) {
    document.getElementById(id).style.display = "none";
}
